macro(ADDPROG name)
    add_executable(${name} ${name}.f90)
    target_link_libraries(${name} hfsolver ${LIBS})
endmacro(ADDPROG)

project(fft)

addprog(sch1d_time_prop)
addtest(test_sch1d_osc)

if(WITH_MPI)
    ADDMPIEXECUTABLE(test_ffte_par)
    ADDMPITEST(test_ffte_par ffte1 1)
    ADDMPITEST(test_ffte_par ffte2 4)
    ADDMPITEST(test_ffte_par ffte3 4 2 2 2 32 32 32 1 2 2)
    ADDMPITEST(test_ffte_par ffte4 4 2 2 2 32 32 32 1 1 2)
    set_tests_properties(ffte4 PROPERTIES WILL_FAIL TRUE)
    ADDMPITEST(test_ffte_par ffte5 3 2 2 2 33 30 30 1 1 3)
    set_tests_properties(ffte5 PROPERTIES WILL_FAIL TRUE)
    ADDMPITEST(test_ffte_par ffte6 3 2 2 2 32 30 30 1 1 3)
    set_tests_properties(ffte6 PROPERTIES WILL_FAIL TRUE)
    ADDMPITEST(test_ffte_par ffte7 3 2 2 2 36 36 36 1 1 3)

    ADDMPIEXECUTABLE(test_it_min)
    ADDMPITEST(test_it_min it_min 4)
    ADDMPIEXECUTABLE(test_it_min_vw1)
    #ADDMPITEST(test_it_min_vw1 it_min_vw1 4)
    ADDMPIEXECUTABLE(test_it_min_vw2)
    #ADDMPITEST(test_it_min_vw2 it_min_vw2 4)
    ADDMPIEXECUTABLE(test_rt)
    ADDMPITEST(test_rt rt 4)
    ADDMPIEXECUTABLE(test_sch_rt)
    #ADDMPITEST(test_sch_rt sch_rt 4)

    if(WITH_ARPACK)
        ADDMPIEXECUTABLE(ks)
        ADDMPIEXECUTABLE(test_vloc)
        #ADDMPITEST(test_vloc vloc 4)
        ADDMPIEXECUTABLE(test_psch3d)
        ADDMPITEST(test_psch3d psch3d 1)

        add_subdirectory(tests_ks)
    endif()
endif()
if(WITH_ARPACK)
    addtest(test_sch3d_eig)
endif()

addtest(test_functional_derivative_min_fft)
set_tests_properties(test_functional_derivative_min_fft PROPERTIES LABELS slow)

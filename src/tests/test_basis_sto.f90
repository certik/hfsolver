program test_sto
use types, only: dp
use sto, only: get_basis, stoints
use utils, only: assert
use constants, only: pi, ang2bohr, Ha2eV
use scf, only: doscf, get_nuclear_energy
implicit none

integer, allocatable, dimension(:) :: nlist, llist, mlist
real(dp), allocatable, dimension(:) :: zetalist
integer, allocatable :: nl(:), ll(:)
real(dp), allocatable :: zl(:)

! -----------------------------
! Simple test I:
allocate(nl(36), zl(36), ll(36))
ll(1:12) = 0 ! s
nl(1:12) = [1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3]
zl(1:12) = [0.1_dp, 1.5_dp, 3.4703_dp, 6.3681_dp, &
    0.7516_dp, 0.9084_dp, 5.80765_dp, 8.53828_dp, &
    0.08_dp, 16.1268_dp, 20.2055_dp, 31.4944_dp]
ll(13:24) = 1 ! p
nl(13:24) = [2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4]
zl(13:24) = [0.20135_dp, 0.95703_dp, 1.943_dp, 2.6986_dp, &
    0.09_dp, 1.46565_dp, 3.35114_dp, 5.1389_dp, &
    0.15969_dp, 0.75902_dp, 8.80274_dp, 11.521_dp]
ll(25:36) = 2 ! d
nl(25:36) = [3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5]
zl(25:36) = [0.074284_dp, 0.373267_dp, 0.83752_dp, 1.3652_dp, &
    1.8273_dp, 2.30093_dp, 0.0805239_dp, 0.512334_dp, &
    3.22431_dp, 4.47682_dp, 6.2468_dp, 8.68472_dp]
call get_basis(nl, zl, ll, nlist, zetalist, llist, mlist)
call assert(all(nlist == &
    [1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,  &
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, &
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, &
4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, &
5, 5, 5, 5, 5, 5]))
call assert(all(llist == &
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, &
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, &
1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, &
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, &
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, &
2, 2, 2, 2, 2, 2, 2, 2]))
call assert(all(mlist == &
    [0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1,  0,  1, &
-1,  0,  1, -1,  0,  1, -1,  0,  1, -1,  0,  1, -1,  0,  1, &
-1,  0,  1, -1,  0,  1, -1,  0,  1, -1,  0,  1, -1,  0,  1, &
-1,  0,  1, -2, -1,  0,  1,  2, -2, -1,  0,  1,  2, -2, -1, &
 0,  1,  2, -2, -1,  0,  1,  2, -2, -1,  0,  1,  2, -2, -1, &
 0,  1,  2, -2, -1,  0,  1,  2, -2, -1,  0,  1,  2, -2, -1, &
 0,  1,  2, -2, -1,  0,  1,  2, -2, -1,  0,  1,  2, -2, -1, &
 0,  1,  2]))
call assert(all(abs(zetalist - [ &
1.00000E-01_dp, 1.50000E+00_dp, 3.47030E+00_dp, 6.36810E+00_dp, 7.51600E-01_dp,&
9.08400E-01_dp, 5.80765E+00_dp, 8.53828E+00_dp, 8.00000E-02_dp, 1.61268E+01_dp,&
2.02055E+01_dp, 3.14944E+01_dp, 2.01350E-01_dp, 2.01350E-01_dp, 2.01350E-01_dp,&
9.57030E-01_dp, 9.57030E-01_dp, 9.57030E-01_dp, 1.94300E+00_dp, 1.94300E+00_dp,&
1.94300E+00_dp, 2.69860E+00_dp, 2.69860E+00_dp, 2.69860E+00_dp, 9.00000E-02_dp,&
9.00000E-02_dp, 9.00000E-02_dp, 1.46565E+00_dp, 1.46565E+00_dp, 1.46565E+00_dp,&
3.35114E+00_dp, 3.35114E+00_dp, 3.35114E+00_dp, 5.13890E+00_dp, 5.13890E+00_dp,&
5.13890E+00_dp, 1.59690E-01_dp, 1.59690E-01_dp, 1.59690E-01_dp, 7.59020E-01_dp,&
7.59020E-01_dp, 7.59020E-01_dp, 8.80274E+00_dp, 8.80274E+00_dp, 8.80274E+00_dp,&
1.15210E+01_dp, 1.15210E+01_dp, 1.15210E+01_dp, 7.42840E-02_dp, 7.42840E-02_dp,&
7.42840E-02_dp, 7.42840E-02_dp, 7.42840E-02_dp, 3.73267E-01_dp, 3.73267E-01_dp,&
3.73267E-01_dp, 3.73267E-01_dp, 3.73267E-01_dp, 8.37520E-01_dp, 8.37520E-01_dp,&
8.37520E-01_dp, 8.37520E-01_dp, 8.37520E-01_dp, 1.36520E+00_dp, 1.36520E+00_dp,&
1.36520E+00_dp, 1.36520E+00_dp, 1.36520E+00_dp, 1.82730E+00_dp, 1.82730E+00_dp,&
1.82730E+00_dp, 1.82730E+00_dp, 1.82730E+00_dp, 2.30093E+00_dp, 2.30093E+00_dp,&
2.30093E+00_dp, 2.30093E+00_dp, 2.30093E+00_dp, 8.05239E-02_dp, 8.05239E-02_dp,&
8.05239E-02_dp, 8.05239E-02_dp, 8.05239E-02_dp, 5.12334E-01_dp, 5.12334E-01_dp,&
5.12334E-01_dp, 5.12334E-01_dp, 5.12334E-01_dp, 3.22431E+00_dp, 3.22431E+00_dp,&
3.22431E+00_dp, 3.22431E+00_dp, 3.22431E+00_dp, 4.47682E+00_dp, 4.47682E+00_dp,&
4.47682E+00_dp, 4.47682E+00_dp, 4.47682E+00_dp, 6.24680E+00_dp, 6.24680E+00_dp,&
6.24680E+00_dp, 6.24680E+00_dp, 6.24680E+00_dp, 8.68472E+00_dp, 8.68472E+00_dp,&
8.68472E+00_dp, 8.68472E+00_dp, 8.68472E+00_dp]) < 1e-10_dp))
deallocate(nl, zl, ll)
! -----------------------------

! -----------------------------
! Simple test II:
allocate(nl(12), zl(12), ll(12))
ll(1:5) = 0 ! s
nl(1:5) = [1, 1, 2, 3, 3]
zl(1:5) = [0.28382_dp, 0.51444_dp, 0.8525_dp, 0.79958_dp, 1.09728_dp]
ll(6:9) = 1 ! p
nl(6:9) = [2, 2, 3, 4]
zl(6:9) = [0.103336_dp, 0.145652_dp, 0.221232_dp, 0.228868_dp]
ll(10:12) = 2 ! d
nl(10:12) = [3, 3, 4]
zl(10:12) = [0.14546_dp, 0.193412_dp, 0.278776_dp]
!zl = zl * 0.2_dp
call get_basis(nl, zl, ll, nlist, zetalist, llist, mlist)
deallocate(nl, zl, ll)

! -----------------------------

! -----------------------------
! Simple test III:
allocate(nl(10), zl(10), ll(10))
ll(1:5) = 0 ! s
nl(1:5) = [1, 1, 2, 2, 3]
zl(1:5) = [5.4297_dp, 2.9954_dp, 1.1977_dp, 0.8923_dp, 3.5810_dp]
ll(6:10) = 1 ! p
nl(6:10) = [2, 2, 3, 3, 4]
zl(6:10) = [5.6998_dp, 2.7850_dp, 1.4387_dp, 0.9819_dp, 4.1500_dp]
call get_basis(nl, zl, ll, nlist, zetalist, llist, mlist)
deallocate(nl, zl, ll)

! -----------------------------
! Simple test IV:
allocate(nl(48), zl(48), ll(48))
ll(1:12) = 0 ! s
nl(1:12) = [1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3]
zl(1:12) = [0.1_dp, 1.5_dp, 3.4703_dp, 6.3681_dp, &
    0.7516_dp, 0.9084_dp, 5.80765_dp, 8.53828_dp, &
    0.08_dp, 16.1268_dp, 20.2055_dp, 31.4944_dp]
ll(13:24) = 1 ! p
nl(13:24) = [2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4]
zl(13:24) = [0.20135_dp, 0.95703_dp, 1.943_dp, 2.6986_dp, &
    0.09_dp, 1.46565_dp, 3.35114_dp, 5.1389_dp, &
    0.15969_dp, 0.75902_dp, 8.80274_dp, 11.521_dp]
ll(25:36) = 2 ! d
nl(25:36) = [3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5]
zl(25:36) = [0.074284_dp, 0.373267_dp, 0.83752_dp, 1.3652_dp, &
    1.8273_dp, 2.30093_dp, 0.0805239_dp, 0.512334_dp, &
    3.22431_dp, 4.47682_dp, 6.2468_dp, 8.68472_dp]
ll(37:48) = 3 ! f
nl(37:48) = [4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5]
zl(37:48) = [14.64884_dp, 1.17503_dp, 17.49577_dp, 4.91401_dp, 9.22804_dp, &
    11.94673_dp, 2.73331_dp, 3.15699_dp, 5.23396_dp, 0.71385_dp, 20.02434_dp, &
    0.84142_dp]
!zl = zl * 0.4_dp
call get_basis(nl, zl, ll, nlist, zetalist, llist, mlist)

end program
